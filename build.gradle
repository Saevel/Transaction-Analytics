group 'org.dmcs'

version '1.0'

buildscript {
    repositories {
        mavenCentral()
        jcenter()
    }

    dependencies {
        classpath 'com.bmuschko:gradle-docker-plugin:3.0.8'
    }
}

apply plugin: 'groovy'

apply plugin: 'com.bmuschko.docker-remote-api'

import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage
import org.dmcs.transaction.analytics.gradle.SubprojectTaskCall

repositories {
    mavenCentral()
    jcenter()
}

docker {
    url=System.getenv('DOCKER_MACHINE_URL')
    certPath=file(System.getenv('DOCKER_CERT_PATH'))
}

task it {
    SubprojectTaskCall.callTaskIfExists(project, 'it')
}

task sparkDocker(type: DockerBuildImage){
    inputDir = project.file(project.projectDir.path + "/src/main/docker")
}

import org.dmcs.transaction.analytics.mesosphere.chronos.ChronosJob

task dockerize {
    SubprojectTaskCall.callTaskIfExists(project, "dockerize")
}

task deploy {
    logger.debug "DCOS Deployment: Deploy all subprojects"
    SubprojectTaskCall.callTaskIfExists(project, "deploy")
}